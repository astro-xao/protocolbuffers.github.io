<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/protocolbuffers.github.io/favicons/favicon.ico><link rel=apple-touch-icon href=/protocolbuffers.github.io/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/protocolbuffers.github.io/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/protocolbuffers.github.io/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/protocolbuffers.github.io/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/protocolbuffers.github.io/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/protocolbuffers.github.io/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/protocolbuffers.github.io/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/protocolbuffers.github.io/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/protocolbuffers.github.io/favicons/android-192x192.png sizes=192x192><title>Go Opaque API：手动迁移 | Protocol Buffers 文档</title>
<meta name=description content="介绍如何手动迁移到 Opaque API。"><meta property="og:title" content="Go Opaque API：手动迁移"><meta property="og:description" content="介绍如何手动迁移到 Opaque API。"><meta property="og:type" content="article"><meta property="og:url" content="https://astro-xao.github.io/protocolbuffers.github.io/reference/go/opaque-migration-manual/"><meta property="article:section" content="reference"><meta itemprop=name content="Go Opaque API：手动迁移"><meta itemprop=description content="介绍如何手动迁移到 Opaque API。"><meta itemprop=wordCount content="1104"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Go Opaque API：手动迁移"><meta name=twitter:description content="介绍如何手动迁移到 Opaque API。"><link rel=preload href=/protocolbuffers.github.io/scss/main.min.27bc098c9a8f7a1246d474f5c8afcee53760c9c7f38125d343ff52e0bf493011.css as=style integrity="sha256-J7wJjJqPehJG1HT1yK/O5TdgycfzgSXTQ/9S4L9JMBE=" crossorigin=anonymous><link href=/protocolbuffers.github.io/scss/main.min.27bc098c9a8f7a1246d474f5c8afcee53760c9c7f38125d343ff52e0bf493011.css rel=stylesheet integrity="sha256-J7wJjJqPehJG1HT1yK/O5TdgycfzgSXTQ/9S4L9JMBE=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-5L8P8GRN4Y"></script><script>var doNotTrack=!1,dnt;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5L8P8GRN4Y")}</script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/protocolbuffers.github.io/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Protocol Buffers 文档</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav></ul></div><div class="d-none d-lg-block"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="td-sidebar-nav collapse td-sidebar-nav--search-disabled" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-protocolbuffersgithubio-li><a href=/protocolbuffers.github.io/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-protocolbuffersgithubio><span>Protocol Buffer</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiooverview-li><a href=/protocolbuffers.github.io/overview/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiooverview><span>概述</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioinstallation-li><a href=/protocolbuffers.github.io/installation/ title="Protocol Buffer 编译器安装" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioinstallation><span>Protoc 安装</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubionews-li><a href=/protocolbuffers.github.io/news/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubionews><span>News</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-protocolbuffersgithubioprogramming-guides-li><a href=/protocolbuffers.github.io/programming-guides/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubioprogramming-guides><span>编程指南</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioprogramming-guidesproto2-li><a href=/protocolbuffers.github.io/programming-guides/proto2/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioprogramming-guidesproto2><span>语言指南 (proto 2)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioprogramming-guidesproto3-li><a href=/protocolbuffers.github.io/programming-guides/proto3/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioprogramming-guidesproto3><span>语言指南 (proto 3)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioprogramming-guideseditions-li><a href=/protocolbuffers.github.io/programming-guides/editions/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioprogramming-guideseditions><span>语言指南(editions)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioprogramming-guidesproto-limits-li><a href=/protocolbuffers.github.io/programming-guides/proto-limits/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioprogramming-guidesproto-limits><span>Proto 限制</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioprogramming-guidesstyle-li><a href=/protocolbuffers.github.io/programming-guides/style/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioprogramming-guidesstyle><span>风格指南</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioprogramming-guidesenum-li><a href=/protocolbuffers.github.io/programming-guides/enum/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioprogramming-guidesenum><span>枚举行为</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioprogramming-guidesencoding-li><a href=/protocolbuffers.github.io/programming-guides/encoding/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioprogramming-guidesencoding><span>Encoding</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioprogramming-guidesjson-li><a href=/protocolbuffers.github.io/programming-guides/json/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioprogramming-guidesjson><span>ProtoJSON 格式</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioprogramming-guidestechniques-li><a href=/protocolbuffers.github.io/programming-guides/techniques/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioprogramming-guidestechniques><span>技术技巧</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioprogramming-guidesaddons-li><a href=/protocolbuffers.github.io/programming-guides/addons/ title=第三方插件 class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioprogramming-guidesaddons><span>插件</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioprogramming-guidesextension_declarations-li><a href=/protocolbuffers.github.io/programming-guides/extension_declarations/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioprogramming-guidesextension_declarations><span>扩展声明</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioprogramming-guidesfield_presence-li><a href=/protocolbuffers.github.io/programming-guides/field_presence/ title="Application Note: Field Presence" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioprogramming-guidesfield_presence><span>Field Presence</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioprogramming-guidesserialization-not-canonical-li><a href=/protocolbuffers.github.io/programming-guides/serialization-not-canonical/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioprogramming-guidesserialization-not-canonical><span>Proto 序列化不是规范化的</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioprogramming-guidesdeserialize-debug-li><a href=/protocolbuffers.github.io/programming-guides/deserialize-debug/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioprogramming-guidesdeserialize-debug><span>反序列化 Debug Proto 表示</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-protocolbuffersgithubioeditions-li><a href=/protocolbuffers.github.io/editions/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubioeditions><span>Protobuf 版本</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioeditionsoverview-li><a href=/protocolbuffers.github.io/editions/overview/ title="Protobuf Editions Overview" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioeditionsoverview><span>Overview</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioeditionsfeatures-li><a href=/protocolbuffers.github.io/editions/features/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioeditionsfeatures><span>Feature Settings for Editions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioeditionsimplementation-li><a href=/protocolbuffers.github.io/editions/implementation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioeditionsimplementation><span>Implementing Editions Support</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-protocolbuffersgithubiodesign-decisions-li><a href=/protocolbuffers.github.io/design-decisions/ title="Protobuf 团队设计决策" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubiodesign-decisions><span>设计决策</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiodesign-decisionsnullable-getters-setters-li><a href=/protocolbuffers.github.io/design-decisions/nullable-getters-setters/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiodesign-decisionsnullable-getters-setters><span>不支持可空 Setter/Getters</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-protocolbuffersgithubiobest-practices-li><a href=/protocolbuffers.github.io/best-practices/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubiobest-practices><span>Proto 最佳实践</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiobest-practicesdos-donts-li><a href=/protocolbuffers.github.io/best-practices/dos-donts/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiobest-practicesdos-donts><span>Proto 最佳实践</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiobest-practicesno-cargo-cults-li><a href=/protocolbuffers.github.io/best-practices/no-cargo-cults/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiobest-practicesno-cargo-cults><span>避免盲目跟风</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiobest-practicesapi-li><a href=/protocolbuffers.github.io/best-practices/api/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiobest-practicesapi><span>API 最佳实践</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiobest-practices1-1-1-li><a href=/protocolbuffers.github.io/best-practices/1-1-1/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiobest-practices1-1-1><span>1-1-1 最佳实践</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-protocolbuffersgithubiogetting-started-li><a href=/protocolbuffers.github.io/getting-started/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubiogetting-started><span>教程</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiogetting-startedcpptutorial-li><a href=/protocolbuffers.github.io/getting-started/cpptutorial/ title="Protocol Buffer Basics: C++" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiogetting-startedcpptutorial><span>C++</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiogetting-startedcsharptutorial-li><a href=/protocolbuffers.github.io/getting-started/csharptutorial/ title="Protocol Buffer Basics: C#" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiogetting-startedcsharptutorial><span>C#</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiogetting-starteddarttutorial-li><a href=/protocolbuffers.github.io/getting-started/darttutorial/ title="Protocol Buffer Basics: Dart" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiogetting-starteddarttutorial><span>Dart</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiogetting-startedgotutorial-li><a href=/protocolbuffers.github.io/getting-started/gotutorial/ title="Protocol Buffer Basics: Go" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiogetting-startedgotutorial><span>Go</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiogetting-startedjavatutorial-li><a href=/protocolbuffers.github.io/getting-started/javatutorial/ title="Protocol Buffer Basics: Java" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiogetting-startedjavatutorial><span>Java</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiogetting-startedkotlintutorial-li><a href=/protocolbuffers.github.io/getting-started/kotlintutorial/ title="Protocol Buffer Basics: Kotlin" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiogetting-startedkotlintutorial><span>Kotlin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiogetting-startedpythontutorial-li><a href=/protocolbuffers.github.io/getting-started/pythontutorial/ title="Protocol Buffer Basics: Python" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiogetting-startedpythontutorial><span>Python</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-protocolbuffersgithubioreference-li><a href=/protocolbuffers.github.io/reference/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubioreference><span>参考指南</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-protocolbuffersgithubioreferencecpp-li><a href=/protocolbuffers.github.io/reference/cpp/ title="C++ Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubioreferencecpp><span>C++</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencecppcpp-generated-li><a href=/protocolbuffers.github.io/reference/cpp/cpp-generated/ title="C++ Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencecppcpp-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencecppstring-view-li><a href=/protocolbuffers.github.io/reference/cpp/string-view/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencecppstring-view><span>String View APIs</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencecpparenas-li><a href=/protocolbuffers.github.io/reference/cpp/arenas/ title="C++ Arena Allocation Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencecpparenas><span>Arena Allocation Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencecppabseil-li><a href=/protocolbuffers.github.io/reference/cpp/abseil/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencecppabseil><span>Abseil Support</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencecppapi-docs-link-li><a href=/reference/cpp/api-docs/ target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencecppapi-docs-link><span>C++ API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-protocolbuffersgithubioreferencecsharp-li><a href=/protocolbuffers.github.io/reference/csharp/ title="C# Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubioreferencecsharp><span>C#</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencecsharpcsharp-generated-li><a href=/protocolbuffers.github.io/reference/csharp/csharp-generated/ title="C# Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencecsharpcsharp-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencecsharpapi-docs-link-li><a href=/reference/csharp/api-docs target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencecsharpapi-docs-link><span>C# API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-protocolbuffersgithubioreferencedart-li><a href=/protocolbuffers.github.io/reference/dart/ title="Dart Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubioreferencedart><span>Dart</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencedartdart-generated-li><a href=/protocolbuffers.github.io/reference/dart/dart-generated/ title="Dart Generated Code" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencedartdart-generated><span>Generated Code</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencedartapi-docs-link-li><a href=https://pub.dartlang.org/documentation/protobuf target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencedartapi-docs-link><span>Dart API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-protocolbuffersgithubioreferencego-li><a href=/protocolbuffers.github.io/reference/go/ title="Go 参考" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubioreferencego><span>Go</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencegogo-generated-li><a href=/protocolbuffers.github.io/reference/go/go-generated/ title="Go 生成代码指南（Open）" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencegogo-generated><span>生成代码指南（Open）</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencegogo-generated-opaque-li><a href=/protocolbuffers.github.io/reference/go/go-generated-opaque/ title="Go 生成代码指南（Opaque）" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencegogo-generated-opaque><span>生成代码指南（Opaque）</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencegofaq-li><a href=/protocolbuffers.github.io/reference/go/faq/ title="Go 常见问题" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencegofaq><span>常见问题</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencegosize-li><a href=/protocolbuffers.github.io/reference/go/size/ title="Go Size 语义" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencegosize><span>Size 语义</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencegoapi-docs-link-li><a href=https://pkg.go.dev/google.golang.org/protobuf/proto target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencegoapi-docs-link><span>Go API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencegoopaque-migration-li><a href=/protocolbuffers.github.io/reference/go/opaque-migration/ title="Go Opaque API 迁移" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencegoopaque-migration><span>Opaque API 迁移</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-protocolbuffersgithubioreferencegoopaque-migration-manual-li><a href=/protocolbuffers.github.io/reference/go/opaque-migration-manual/ title="Go Opaque API：手动迁移" class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencegoopaque-migration-manual><span class=td-sidebar-nav-active-item>Opaque API：手动迁移</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencegoopaque-faq-li><a href=/protocolbuffers.github.io/reference/go/opaque-faq/ title="Go Opaque API 常见问题解答" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencegoopaque-faq><span>Opaque API 常见问题解答</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-protocolbuffersgithubioreferencejava-li><a href=/protocolbuffers.github.io/reference/java/ title="Java Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubioreferencejava><span>Java</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencejavajava-generated-li><a href=/protocolbuffers.github.io/reference/java/java-generated/ title="Java Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencejavajava-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencejavajava-proto-names-li><a href=/protocolbuffers.github.io/reference/java/java-proto-names/ title="Java Proto Names" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencejavajava-proto-names><span>Generated Proto Names</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencejavaapi-docs-link-li><a href=/reference/java/api-docs/overview-summary.html target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencejavaapi-docs-link><span>Java API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-protocolbuffersgithubioreferencekotlin-li><a href=/protocolbuffers.github.io/reference/kotlin/ title="Kotlin Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubioreferencekotlin><span>Kotlin</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencekotlinapi-docs-li><a href=/protocolbuffers.github.io/reference/kotlin/api-docs/ title="Kotlin Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubioreferencekotlinapi-docs><span>Kotlin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencekotlinkotlin-generated-li><a href=/protocolbuffers.github.io/reference/kotlin/kotlin-generated/ title="Kotlin Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencekotlinkotlin-generated><span>Generated Code Guide</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-protocolbuffersgithubioreferenceobjective-c-li><a href=/protocolbuffers.github.io/reference/objective-c/ title="Objective-C Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubioreferenceobjective-c><span>Objective-C</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferenceobjective-cobjective-c-generated-li><a href=/protocolbuffers.github.io/reference/objective-c/objective-c-generated/ title="Objective-C Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferenceobjective-cobjective-c-generated><span>Generated Code Guide</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-protocolbuffersgithubioreferencephp-li><a href=/protocolbuffers.github.io/reference/php/ title="PHP Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubioreferencephp><span>PHP</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencephpphp-generated-li><a href=/protocolbuffers.github.io/reference/php/php-generated/ title="PHP Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencephpphp-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencephpapi-docs-link-li><a href=/reference/php/api-docs/ target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencephpapi-docs-link><span>PHP API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-protocolbuffersgithubioreferencepython-li><a href=/protocolbuffers.github.io/reference/python/ title="Python Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubioreferencepython><span>Python</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencepythonpython-generated-li><a href=/protocolbuffers.github.io/reference/python/python-generated/ title="Python Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencepythonpython-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencepythonapi-docs-link-li><a href=https://googleapis.dev/python/protobuf/latest/ target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencepythonapi-docs-link><span>Python API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-protocolbuffersgithubioreferenceruby-li><a href=/protocolbuffers.github.io/reference/ruby/ title="Ruby Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubioreferenceruby><span>Ruby</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferencerubyruby-generated-li><a href=/protocolbuffers.github.io/reference/ruby/ruby-generated/ title="Ruby Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferencerubyruby-generated><span>Generated Code Guide</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-protocolbuffersgithubioreferenceprotobuf-li><a href=/protocolbuffers.github.io/reference/protobuf/ title="Protocol Buffers Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubioreferenceprotobuf><span>Protocol Buffers</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferenceprotobufedition-2023-spec-li><a href=/protocolbuffers.github.io/reference/protobuf/edition-2023-spec/ title="Protocol Buffers Edition 2023 Language Specification" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferenceprotobufedition-2023-spec><span>2023 Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferenceprotobufproto2-spec-li><a href=/protocolbuffers.github.io/reference/protobuf/proto2-spec/ title="Protocol Buffers Version 2 Language Specification" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferenceprotobufproto2-spec><span>Version 2 Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferenceprotobufproto3-spec-li><a href=/protocolbuffers.github.io/reference/protobuf/proto3-spec/ title="Protocol Buffers Version 3 Language Specification" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferenceprotobufproto3-spec><span>Version 3 Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferenceprotobuftextformat-spec-li><a href=/protocolbuffers.github.io/reference/protobuf/textformat-spec/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferenceprotobuftextformat-spec><span>Text Format Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferenceprotobufgoogleprotobuf-li><a href=/protocolbuffers.github.io/reference/protobuf/google.protobuf/ title="Protocol Buffers Well-Known Types" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferenceprotobufgoogleprotobuf><span>Well-Known Types</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioreferenceother-li><a href=/protocolbuffers.github.io/reference/other/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioreferenceother><span>其他语言</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-protocolbuffersgithubiosupport-li><a href=/protocolbuffers.github.io/support/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-protocolbuffersgithubiosupport><span>Support</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiosupportversion-support-li><a href=/protocolbuffers.github.io/support/version-support/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiosupportversion-support><span>Version Support</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiosupportmigration-li><a href=/protocolbuffers.github.io/support/migration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiosupportmigration><span>Migration Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiosupportcross-version-runtime-guarantee-li><a href=/protocolbuffers.github.io/support/cross-version-runtime-guarantee/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiosupportcross-version-runtime-guarantee><span>Cross-Version Runtime Guarantee</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiodownloads-li><a href=/protocolbuffers.github.io/downloads/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiodownloads><span>Downloads</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiohistory-li><a href=/protocolbuffers.github.io/history/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiohistory><span>History</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubioforum-link-li><a href=https://groups.google.com/g/protobuf target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubioforum-link><span>Forum</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubionavbar-li><a href=/protocolbuffers.github.io/navbar/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubionavbar><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-protocolbuffersgithubiosearch-li><a href=/protocolbuffers.github.io/search/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-protocolbuffersgithubiosearch><span>Search Results</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/astro-xao/protocolbuffers.github.io//tree/main/content/reference/go/opaque-migration-manual.md class=td-page-meta--view target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/astro-xao/protocolbuffers.github.io//edit/main/content/reference/go/opaque-migration-manual.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/astro-xao/protocolbuffers.github.io//new/main/content/reference/go/opaque-migration-manual.md?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/astro-xao/protocolbuffers.github.io//issues/new?title=Go%20Opaque%20API%ef%bc%9a%e6%89%8b%e5%8a%a8%e8%bf%81%e7%a7%bb" class=td-page-meta--issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/protocolbuffers/protobuf/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><ul><li><a href=#消息构造>消息构造</a></li><li><a href=#标量字段>标量字段</a></li><li><a href=#消息字段>消息字段</a></li><li><a href=#重复字段>重复字段</a></li><li><a href=#map-字段>Map 字段</a></li><li><a href=#oneof-字段>Oneof 字段</a></li><li><a href=#反射>反射</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/protocolbuffers.github.io/reference/>参考指南</a></li><li class=breadcrumb-item><a href=/protocolbuffers.github.io/reference/go/>Go</a></li><li class="breadcrumb-item active" aria-current=page>Opaque API：手动迁移</li></ol></nav><div class=td-content><h1>Go Opaque API：手动迁移</h1><div class=lead>介绍如何手动迁移到 Opaque API。</div><header class=article-meta></header><p>Opaque API 是 Protocol Buffers 在 Go 语言中的最新实现。旧版本现在称为 Open Struct API。请参阅 <a href=https://go.dev/blog/protobuf-opaque>Go Protobuf: Releasing the Opaque API</a> 博客文章以了解简介。</p><p>本文档为将 Go Protobuf 用法从旧的 Open Struct API 迁移到新的 Opaque API 的用户指南。</p><div class="alert alert-warning" role=alert><h4 class=alert-heading>警告</h4>您正在查看手动迁移指南。通常建议使用 <code>open2opaque</code> 工具自动迁移。请参阅 <a href=./reference/go/opaque-migration>Opaque API 迁移</a> 获取更多信息。</div><p><a href=./reference/go/go-generated-opaque>生成代码指南</a> 提供了更多细节。本文将新旧 API 进行对比。</p><h3 id=消息构造>消息构造</h3><p>假设有如下 protobuf 消息定义：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>uint32</span> <span style=color:#204a87;font-weight:700>uint32</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>bytes</span> <span style=color:#204a87;font-weight:700>bytes</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>oneof</span> <span style=color:#000>union</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>string</span>    <span style=color:#204a87;font-weight:700>string</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>MyMessage</span> <span style=color:#204a87;font-weight:700>message</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>Kind</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>};</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>Kind</span> <span style=color:#000>kind</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>9</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>以下是如何从字面值构造该消息的示例：</p><table width=100%><tr><td width=50%>Open Struct API（旧）</td><td width=50%>Opaque API（新）</td></tr><tr><td><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Uint32</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>proto</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Uint32</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Bytes</span><span style=color:#000;font-weight:700>:</span>  <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87>byte</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;hello&#34;</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></td><td><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo_builder</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Uint32</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>proto</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Uint32</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Bytes</span><span style=color:#000;font-weight:700>:</span>  <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87>byte</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;hello&#34;</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>Build</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div></td></tr></table><p>可以看到，builder 结构体允许 Open Struct API（旧）与 Opaque API（新）之间几乎 1:1 的转换。</p><p>通常建议使用 builder 以提高可读性。仅在极少数情况下（如在高频循环中创建 Protobuf 消息）才建议使用 setter。详情请参阅 <a href=./reference/go/opaque-faq#builders-vs-setters>Opaque API 常见问题：应使用 builder 还是 setter？</a>。</p><p>对于 <a href=#oneofs>oneof</a> 字段有例外：Open Struct API（旧）为每个 oneof case 使用包装结构体类型，而 Opaque API（新）将 oneof 字段视为普通消息字段：</p><table width=100%><tr><td width=50%>Open Struct API（旧）</td><td width=50%>Opaque API（新）</td></tr><tr><td><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Uint32</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>myScalar</span><span style=color:#000;font-weight:700>,</span>  <span style=color:#8f5902;font-style:italic>// 可能为 nil
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>Union</span><span style=color:#000;font-weight:700>:</span>  <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo_String</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>myString</span><span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Kind</span><span style=color:#000;font-weight:700>:</span>   <span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo_SPECIAL_KIND</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Enum</span><span style=color:#000;font-weight:700>(),</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></td><td><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo_builder</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Uint32</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>myScalar</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>String</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>myString</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Kind</span><span style=color:#000;font-weight:700>:</span>   <span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo_SPECIAL_KIND</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Enum</span><span style=color:#000;font-weight:700>(),</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>Build</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div></td></tr></table><p>对于 oneof union 相关的 Go 结构体字段，只能有一个字段被赋值。如果多个 oneof case 字段被赋值，则以 .proto 文件中字段声明顺序的最后一个为准。</p><h3 id=标量字段>标量字段</h3><p>假设有如下带标量字段的消息定义：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Artist</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>birth_year</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>对于 Go 使用标量类型（bool、int32、int64、uint32、uint64、float32、float64、string、[]byte 和 enum）的 Protobuf 字段，会生成 <code>Get</code> 和 <code>Set</code> 访问器方法。具有 <a href=./programming-guides/field_presence/>显式存在性</a> 的字段还会有 <code>Has</code> 和 <code>Clear</code> 方法。</p><p>对于名为 <code>birth_year</code> 的 int32 字段，将生成如下访问器方法：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Artist</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>GetBirthYear</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>int32</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Artist</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>SetBirthYear</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v</span> <span style=color:#204a87;font-weight:700>int32</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Artist</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>HasBirthYear</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>bool</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Artist</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>ClearBirthYear</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p><code>Get</code> 返回字段的值。如果字段未设置或消息接收者为 nil，则返回默认值。默认值为 <a href=https://go.dev/ref/spec#The_zero_value>零值</a>，除非通过 default 选项显式设置。</p><p><code>Set</code> 将提供的值存储到字段中。若在 nil 消息接收者上调用会 panic。</p><p>对于 bytes 字段，使用 nil []byte 调用 <code>Set</code> 也会被视为已设置。例如，随后调用 <code>Has</code> 会返回 true。随后调用 <code>Get</code> 会返回零长度切片（可能为 nil 或空切片）。用户应使用 <code>Has</code> 判断存在性，而不是依赖 <code>Get</code> 是否返回 nil。</p><p><code>Has</code> 报告字段是否已赋值。在 nil 消息接收者上调用返回 false。</p><p><code>Clear</code> 清除字段。在 nil 消息接收者上调用会 panic。</p><p><strong>字符串字段示例代码：</strong></p><table width=100%><tr><td width=50%>Open Struct API（旧）</td><td width=50%>Opaque API（新）</td></tr><tr><td><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取字段值
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetBirthYear</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 设置字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>BirthYear</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>proto</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Int32</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1989</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 检查是否存在
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>s</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>BirthYear</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 清除字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>BirthYear</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>nil</span>
</span></span></code></pre></div></td><td><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取字段值
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetBirthYear</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 设置字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetBirthYear</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1989</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 检查是否存在
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HasBirthYear</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 清除字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ClearBirthYear</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div></td></tr></table><h3 id=消息字段>消息字段</h3><p>假设有如下带消息类型字段的消息定义：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Band</span> <span style=color:#000;font-weight:700>{}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Concert</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>Band</span> <span style=color:#000>headliner</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>消息类型字段会生成 <code>Get</code>、<code>Set</code>、<code>Has</code> 和 <code>Clear</code> 方法。</p><p>对于名为 <code>headliner</code> 的消息类型字段，将生成如下访问器方法：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Concert</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>GetHeadliner</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Band</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Concert</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>SetHeadliner</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Band</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Concert</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>HasHeadliner</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>bool</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Concert</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>ClearHeadliner</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p><code>Get</code> 返回字段的值。如果未设置或在 nil 消息接收者上调用则返回 nil。判断 <code>Get</code> 是否为 nil 等价于判断 <code>Has</code> 是否为 false。</p><p><code>Set</code> 将提供的值存储到字段中。在 nil 消息接收者上调用会 panic。用 nil 指针调用 <code>Set</code> 等价于调用 <code>Clear</code>。</p><p><code>Has</code> 报告字段是否已赋值。在 nil 消息接收者上调用返回 false。</p><p><code>Clear</code> 清除字段。在 nil 消息接收者上调用会 panic。</p><p><strong>示例代码：</strong></p><table width=100%><tr><td width=50%>Open Struct API（旧）</td><td width=50%>Opaque（新）</td></tr><tr><td><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取字段值
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>b</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetHeadliner</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 设置字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Headliner</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Band</span><span style=color:#000;font-weight:700>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 检查是否存在
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>s</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Headliner</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 清除字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Headliner</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>nil</span>
</span></span></code></pre></div></td><td><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取字段值
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetHeadliner</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 设置字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetHeadliner</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Band</span><span style=color:#000;font-weight:700>{})</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 检查是否存在
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HasHeadliner</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 清除字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ClearHeadliner</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div></td></tr></table><h3 id=重复字段>重复字段</h3><p>假设有如下带重复消息类型字段的消息定义：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Concert</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Band</span> <span style=color:#000>support_acts</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>重复字段会生成 <code>Get</code> 和 <code>Set</code> 方法。</p><p><code>Get</code> 返回字段的值。如果字段未设置或消息接收者为 nil，则返回 nil。</p><p><code>Set</code> 将提供的值存储到字段中。在 nil 消息接收者上调用会 panic。<code>Set</code> 会存储传入切片头的副本。对切片内容的更改会反映到重复字段中。因此，如果用空切片调用 <code>Set</code>，随后调用 <code>Get</code> 会返回同一个切片。对于 wire 或文本序列化输出，传入的 nil 切片与空切片无区别。</p><p>对于消息 <code>Concert</code> 上名为 <code>support_acts</code> 的重复消息类型字段，将生成如下访问器方法：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Concert</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>GetSupportActs</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Band</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Concert</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>SetSupportActs</span><span style=color:#000;font-weight:700>([]</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Band</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p><strong>示例代码：</strong></p><table width=100%><tr><td width=50%>Open Struct API（旧）</td><td width=50%>Opaque API（新）</td></tr><tr><td><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取整个重复字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>v</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetSupportActs</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 设置字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SupportActs</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>v</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取某个元素
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>e</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SupportActs</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 设置某个元素
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SupportActs</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>e</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取长度
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>n</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetSupportActs</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 截断
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SupportActs</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SupportActs</span><span style=color:#000;font-weight:700>[:</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 追加
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SupportActs</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87>append</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetSupportActs</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>e</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SupportActs</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87>append</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetSupportActs</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>v</span><span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 清除字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SupportActs</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>nil</span>
</span></span></code></pre></div></td><td><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取整个重复字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>v</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetSupportActs</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 设置字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetSupportActs</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取某个元素
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>e</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetSupportActs</span><span style=color:#000;font-weight:700>()[</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 设置某个元素
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetSupportActs</span><span style=color:#000;font-weight:700>()[</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>e</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取长度
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>n</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetSupportActs</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 截断
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetSupportActs</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetSupportActs</span><span style=color:#000;font-weight:700>()[:</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>])</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 追加
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetSupportActs</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>append</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetSupportActs</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>e</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetSupportActs</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>append</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetSupportActs</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>v</span><span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 清除字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetSupportActs</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>nil</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div></td></tr></table><h3 id=map-字段>Map 字段</h3><p>假设有如下带 map 类型字段的消息定义：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MerchBooth</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>map</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>MerchItems</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000>items</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Map 字段会生成 <code>Get</code> 和 <code>Set</code> 方法。</p><p><code>Get</code> 返回字段的值。如果字段未设置或消息接收者为 nil，则返回 nil。</p><p><code>Set</code> 将提供的值存储到字段中。在 nil 消息接收者上调用会 panic。<code>Set</code> 会存储传入 map 引用的副本。对传入 map 的更改会反映到字段中。</p><p>对于消息 <code>MerchBooth</code> 上名为 <code>items</code> 的 map 字段，将生成如下访问器方法：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>MerchBooth</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>GetItems</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>map</span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>MerchItem</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>MerchBooth</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>SetItems</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>map</span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>MerchItem</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p><strong>示例代码：</strong></p><table width=100%><tr><td width=50%>Open Struct API（旧）</td><td width=50%>Opaque API（新）</td></tr><tr><td><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取整个 map
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>v</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetItems</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 设置字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Items</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>v</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取某个元素
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>v</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Items</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>k</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 设置某个元素
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 若 m.Items 为 nil 会 panic
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 应先检查 m.Items 是否为 nil
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Items</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>k</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>v</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 删除元素
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>delete</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Items</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>k</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取 map 长度
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>n</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetItems</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 清除字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Items</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>nil</span>
</span></span></code></pre></div></td><td><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取整个 map
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>v</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetItems</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 设置字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetItems</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取某个元素
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>v</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetItems</span><span style=color:#000;font-weight:700>()[</span><span style=color:#000>k</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 设置某个元素
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 若 m.GetItems() 为 nil 会 panic
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 应先检查 m.GetItems() 是否为 nil
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetItems</span><span style=color:#000;font-weight:700>()[</span><span style=color:#000>k</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>v</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 删除元素
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>delete</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetItems</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>k</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取 map 长度
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>n</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetItems</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 清除字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetItems</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>nil</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div></td></tr></table><h3 id=oneof-字段>Oneof 字段</h3><p>对于每个 oneof union 分组，消息上会有 <code>Which</code>、<code>Has</code> 和 <code>Clear</code> 方法。每个 oneof case 字段也会有 <code>Get</code>、<code>Set</code>、<code>Has</code> 和 <code>Clear</code> 方法。</p><p>假设有如下 oneof 字段 <code>image_url</code> 和 <code>image_data</code>，位于 oneof <code>avatar</code> 中：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Profile</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>oneof</span> <span style=color:#000>avatar</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>image_url</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>bytes</span> <span style=color:#000>image_data</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>该 oneof 的 Opaque API 生成如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Profile</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>WhichAvatar</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000>case_Profile_Avatar</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Profile</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>HasAvatar</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Profile</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>ClearAvatar</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>case_Profile_Avatar</span> <span style=color:#000>protoreflect</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FieldNumber</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Profile_Avatar_not_set_case</span> <span style=color:#000>case_Profile_Avatar</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Profile_ImageUrl_case</span> <span style=color:#000>case_Profile_Avatar</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Profile_ImageData_case</span> <span style=color:#000>case_Profile_Avatar</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p><code>Which</code> 返回已设置的 case 字段编号。若未设置或在 nil 消息接收者上调用则返回 0。</p><p><code>Has</code> 报告 oneof 内是否有字段被设置。在 nil 消息接收者上调用返回 false。</p><p><code>Clear</code> 清除当前已设置的 oneof 字段。在 nil 消息接收者上调用会 panic。</p><p>每个 oneof case 字段的 Opaque API 生成如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Profile</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>GetImageUrl</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Profile</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>GetImageData</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>byte</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Profile</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>SetImageUrl</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Profile</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>SetImageData</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>byte</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Profile</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>HasImageUrl</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Profile</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>HasImageData</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Profile</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>ClearImageUrl</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Profile</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>ClearImageData</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><code>Get</code> 返回 case 字段的值。若 case 字段未设置或在 nil 消息接收者上调用则返回零值。</p><p><code>Set</code> 将提供的值存储到 case 字段，并隐式清除 oneof union 中之前已赋值的 case 字段。对 oneof 消息类型 case 字段用 nil 值调用 <code>Set</code> 会设置为空消息。在 nil 消息接收者上调用会 panic。</p><p><code>Has</code> 报告 case 字段是否被设置。在 nil 消息接收者上调用返回 false。</p><p><code>Clear</code> 清除 case 字段。如果之前已设置，则 oneof union 也会被清除。如果 oneof union 已设置为其他字段，则不会清除。在 nil 消息接收者上调用会 panic。</p><p><strong>示例代码：</strong></p><table width=100%><tr><td width=50%>Open Struct API（旧）</td><td width=50%>Opaque API（新）</td></tr><tr><td><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取已设置的 oneof 字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>switch</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetAvatar</span><span style=color:#000;font-weight:700>().(</span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Profile_ImageUrl</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetImageUrl</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Profile_ImageData</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetImageData</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 设置字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Avatar</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Profile_ImageUrl</span><span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;http://&#34;</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Avatar</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Profile_ImageData</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>img</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 检查是否有 oneof 字段被设置
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Avatar</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 清除字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Avatar</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>nil</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 检查特定字段是否被设置
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetAvatar</span><span style=color:#000;font-weight:700>().(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Profile_ImageUrl</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>ok</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 清除特定字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetAvatar</span><span style=color:#000;font-weight:700>().(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Profile_ImageUrl</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>ok</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Avatar</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>nil</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 拷贝 oneof 字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Avatar</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>src</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Avatar</span>
</span></span></code></pre></div></td><td><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 获取已设置的 oneof 字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>switch</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WhichAvatar</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Profile_ImageUrl_case</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetImageUrl</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Profile_ImageData_case</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetImageData</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 设置字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetImageUrl</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetImageData</span><span style=color:#000;font-weight:700>([]</span><span style=color:#204a87>byte</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;…&#34;</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 检查是否有 oneof 字段被设置
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HasAvatar</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 清除字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ClearAvatar</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 检查特定字段是否被设置
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HasImageUrl</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#a40000>…</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 清除特定字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ClearImageUrl</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 拷贝 oneof 字段
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>switch</span> <span style=color:#000>src</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WhichAvatar</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Profile_ImageUrl_case</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetImageUrl</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>src</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetImageUrl</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Profile_ImageData_case</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetImageData</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>src</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetImageData</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></td></tr></table><h3 id=反射>反射</h3><p>在 proto 消息类型上使用 Go 的 <code>reflect</code> 包访问结构体字段和标签的代码，在迁移离 Open Struct API 后将不再可用。代码需要迁移到 <a href=https://pkg.go.dev/google.golang.org/protobuf/reflect/protoreflect>protoreflect</a>。</p><p>一些常见库在底层使用 Go <code>reflect</code>，例如：</p><ul><li><a href=https://pkg.go.dev/encoding/json/>encoding/json</a><ul><li>请使用 <a href=https://pkg.go.dev/google.golang.org/protobuf/encoding/protojson>protobuf/encoding/protojson</a>。</li></ul></li><li><a href=https://pkg.go.dev/github.com/kr/pretty>pretty</a></li><li><a href=https://pkg.go.dev/github.com/google/go-cmp/cmp>cmp</a><ul><li>若要正确使用 <code>cmp.Equal</code> 比较 protobuf 消息，请使用 <a href=https://pkg.go.dev/google.golang.org/protobuf/testing/protocmp#Transform>protocmp.Transform</a></li></ul></li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel=noopener href=https://stackoverflow.com/questions/tagged/protocol-buffers aria-label="Stack Overflow"><i class="fab fa-stack-overflow"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/protocolbuffers/protobuf aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/protobuf aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2025 Google LLC All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></small>
<span class=text-white>Hosted by GitHub Pages.</span> <a href=https://docs.github.com/en/site-policy/privacy-policies/github-privacy-statement target=_blank>GitHub Privacy Statement</a></div></div></div></footer></div><script src=/protocolbuffers.github.io/js/main.min.465e525b7f12005beca2f93e7a2facf1d7da354d8fa99daffa84ddbfba25da98.js integrity="sha256-Rl5SW38SAFvsovk+ei+s8dfaNU2PqZ2v+oTdv7ol2pg=" crossorigin=anonymous></script><script defer src=/protocolbuffers.github.io/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/protocolbuffers.github.io/js/tabpane-persist.js></script></body></html>